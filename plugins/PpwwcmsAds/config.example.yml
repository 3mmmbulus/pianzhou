# 将本段合并到站点的 config/config.yml 中（重要）
#
# 你要做的事：
# 1) 打开站点配置：fzxingluo.com/index/config/config.yml
# 2) 把下面整段（从 PpwwcmsAds: 开始）复制进去
# 3) 按你的需要改 slot 名称、路径规则、素材内容
#
# 注意：YAML 的顶级键名必须是 PpwwcmsAds（大小写也要一致）
# 说明：
# - “placements” 是把广告位挂到主题区域/正文区域
# - “slots” 才是真正定义广告内容、规则、频控、设备等
# - placements 里写的值（比如 header: header_banner）必须能在 slots 里找到同名的 slot

PpwwcmsAds:
  # 总开关：
  # - true  启用插件
  # - false 关闭插件（所有广告都不输出）
  enabled: true

  # 当页面本身是 noindex 时是否自动禁用广告：
  # - true  建议开启：避免 noindex 页还插广告
  # - false 即使页面 noindex 也照样插广告（一般不推荐）
  disable_on_noindex: true

  # 是否启用正文短码（最简单的“在正文里插广告”的方式）：
  # - true  启用：你在 Markdown 正文里写 [[ads:slot-name]] 就会被替换成广告
  # - false 禁用：正文里写了也不会替换
  #
  # 例子：
  #   文章正文写：
  #     这里是一段文字...
  #     [[ads:in_article_1]]
  #     这里是下一段...
  shortcode: true

  # 主题级广告位绑定（把 slot 映射到“页面区域”）
  #
  # 说明：
  # - header/footer/sidebar 需要你的主题 Twig 模板输出 pico_ads.header/footer/sidebar 才能看到（推荐做一次主题接入）
  # - content_top/content_bottom/after_paragraph 是“正文内容注入”，不改主题也能生效
  #
  # 你可以只用其中一部分：
  # - 只用正文注入：保留 content_* / after_paragraph
  # - 只用主题区域：保留 header/footer/sidebar
  placements:
    # 主题头部区域广告：对应 slots 里的 header_banner
    header: header_banner
    # 主题底部区域广告
    footer: footer_banner
    # 主题侧边栏区域广告
    sidebar: sidebar_box

    # 正文最上方插入一个广告（会拼到正文 HTML 最前面）
    content_top: content_top
    # 正文最下方插入一个广告（会拼到正文 HTML 最末尾）
    content_bottom: content_bottom

    # 在第 N 段之后插入广告（段落的概念通常是 <p> 或换行分段）
    # - n: 2 表示“第2段之后”
    # - slot: 要插入的 slot 名
    # 小提醒：多条 after_paragraph 会从“大 n 到小 n”插入，避免段落序号被前一次插入影响
    after_paragraph:
      - n: 2
        slot: in_article_1
      - n: 5
        slot: in_article_2

  # 运行时脚本（前端 JS）：
  # 负责这些功能：
  # - 频控（frequency）：比如“每个用户每天最多显示 10 次”
  # - 设备限制（device）：只在手机/只在电脑显示
  # - lazy（懒加载）：广告进入视口附近才显示
  # - 侵入式 overlay（弹窗倒计时、点击跳转、关闭按钮）
  #
  # 大多数情况下你不用管它，插件会在需要时自动注入 pico_ads._runtime
  runtime:
    # force:
    # - false（默认）仅当你使用了频控/设备/lazy/侵入式时才注入脚本（更省性能）
    # - true  无论有没有用到也注入（一般不需要）
    force: false

    # external.enabled:
    # - true  使用外链 JS：页面只输出 <script src="/ads/runtime.js">，HTML 源码更“干净”（推荐）
    # - false 使用内联 JS：页面源码会看到一大段 <script>...</script>
    #
    # 注意：开启 external 后，插件会提供一个端点：
    # - %base_url%/ads/runtime.js
    # 你可以在浏览器里直接打开看看是否正常返回 JS。
    external:
      enabled: false

  # 全局定向参数
  targeting:
    # mobile_breakpoint：
    # - 用于区分“手机/电脑”的断点宽度（px）
    # - device=mobile/desktop 的判断依据就是这个
    mobile_breakpoint: 768

  # 合规（强烈建议保持默认/或更严格）
  compliance:
    # 广告标识文字（会显示在每个广告 wrapper 里）
    label_text: "广告"
    # 广告标识的 class（你可以在主题 CSS 里定义样式）
    label_class: "ppww-ads__label"
    # 广告整体 wrapper 的 class（所有广告外层都有这个 class）
    wrapper_class: "ppww-ads"
    # 是否给广告链接加 nofollow：
    # - false 默认只加 rel="sponsored"
    # - true  加 rel="sponsored nofollow"
    nofollow: false

  # 安全（默认最安全）
  security:
    # html_mode：
    # - whitelist（默认，推荐）：会对 creatives.type=html 的内容做白名单清洗，尽量防 XSS
    # - raw（不推荐）：完全原样输出 HTML（风险很高，只有你确认内容完全可信才用）
    html_mode: whitelist   # whitelist|raw

    # allow_script：
    # - false（默认）即使 raw，也会尽量阻止/清理 script（更安全）
    # - true  允许输出 <script>（风险更高；仅当你确实要投第三方脚本才开启）
    allow_script: false

    # csp_nonce：
    # - 如果你站点启用了 CSP，并且需要给广告脚本加 nonce，可以打开
    # - 插件会生成 pico_ads.csp_nonce，并给运行时 <script> 加 nonce
    csp_nonce:
      enabled: false

  # 可观测性（日志统计）
  observability:
    # enabled:
    # - true  记录聚合统计到 plugins/PpwwcmsAds/logs/YYYY-MM-DD.json
    # - false 不写日志
    enabled: true

  # 侵入式（高风险！带护栏）
  #
  # 这是“弹窗/遮罩/倒计时/点击跳转”那一套。
  # 默认关闭。你要用必须显式开启，并且只对指定 paths 生效。
  intrusive:
    # 总开关：
    # - false 默认关闭（建议）
    # - true  开启侵入式（只建议用于你明确需要的落地页）
    enabled: false

    # 仅这些路径生效（强制护栏）：
    # - 这里写的是“允许弹窗出现的页面路径”，没匹配就绝不弹
    # - 写法建议用 glob（最直观）：
    #   "/landing/*"  表示 /landing/ 下的所有路径
    #   "/"          表示首页
    #
    # 注意：这不是 slot 的 targeting，而是“侵入式总开关的路径白名单”
    paths:
      - "/landing/*"

    # overlay_slot：
    # - 指定“弹窗里要展示的广告内容”来自哪个 slot
    # - 这个 slot 也需要在 slots: 里定义
    overlay_slot: intrusive_overlay

    # countdown_seconds：
    # - 弹窗出现后，关闭按钮需要等待多少秒才能点击（倒计时）
    # - 设为 0 表示不倒计时
    countdown_seconds: 3

    # cta_url：
    # - 弹窗里的“行动按钮（CTA）”点击跳转到哪里
    # - 插件只允许“用户点击触发跳转”，不会做 301 强制跳转（护栏）
    cta_url: "https://example.com/"

    # force_noindex：
    # - true（默认建议）：侵入式页面自动强制 noindex,nofollow（meta + X-Robots-Tag）
    # - false 不强制（不建议，容易引起 SEO 风险）
    force_noindex: true

    # frequency（侵入式弹窗频控）：
    # - 用 localStorage 做“同一路径多久最多弹一次”，避免每次打开都弹
    frequency:
      enabled: true
      # ttl_seconds：
      # - 86400 表示 24 小时
      # - 3600  表示 1 小时
      ttl_seconds: 86400

  # 具体广告位（slot）定义（核心！）
  #
  # slot 的结构一般是：
  # slots:
  #   slot_name:
  #     targeting: ...  （这个广告位在哪些页面/设备/来源允许展示）
  #     frequency: ...  （频控：每用户每小时/每天最多展示几次）
  #     lazy: ...       （是否懒加载）
  #     creatives:      （素材列表：可以多条，支持权重轮播/A-B）
  #       - id: ...
  #         type: image|links|html
  #         ...
  slots:
    header_banner:
      targeting:
        # path_include：路径白名单（命中才显示）
        # 典型写法：
        # - "/" 首页
        # - "/posts/*" 文章列表/文章页
        path_include:
          - "/"
          - "/posts/*"
      frequency:
        # window:
        # - day  按“每天”计数
        # - hour 按“每小时”计数
        window: day   # day|hour
        # max：在这个 window 内最多展示多少次（每个用户，用 localStorage 实现）
        max: 10
        # scope：
        # - slot（默认）按 slot 统计
        # - 预留字段（当前实现等同 slot）
        scope: slot
      # lazy：
      # - true  懒加载（进入视口附近才显示）
      # - false 立即显示
      lazy: false
      creatives:
        # creatives：素材列表
        # - 可以多条，通过 weight 做加权轮播（用于 A/B 测试很方便）
        - id: h1
          weight: 100
          # type:
          # - image 图片广告（可选 href）
          # - links 链接列表
          # - html  自定义 HTML（默认会做白名单清洗）
          type: image
          src: "/assets/ads/header-1.jpg"
          href: "https://advertiser.example/"
          alt: "赞助"

    sidebar_box:
      targeting:
        # device：设备限制
        # - all（默认）手机电脑都显示
        # - mobile 只在手机显示
        # - desktop 只在电脑显示
        device: desktop  # all|mobile|desktop
        path_include:
          - "/posts/*"
      creatives:
        - id: s1
          type: links
          # links 类型：items 是多个链接
          items:
            - text: "合作伙伴 A"
              url: "https://a.example/"
            - text: "合作伙伴 B"
              url: "https://b.example/"

    in_article_1:
      targeting:
        path_include:
          - "/posts/*"
      creatives:
        - id: c1a
          type: html
          weight: 50
          # html 类型：可以写简单的 HTML 片段
          # 默认会 whitelist 清洗：
          # - 建议只放安全标签（div/span/a/img 等）
          # - 不要放复杂脚本（默认会被清理/阻止）
          html: "<div>赞助内容 A</div>"
        - id: c1b
          type: html
          weight: 50
          html: "<div>赞助内容 B</div>"

    intrusive_overlay:
      targeting:
        path_include:
          - "/landing/*"
      creatives:
        - id: ov1
          type: html
          # 侵入式弹窗里的内容也是一个 slot 的 creatives
          # 你可以把它写成“横幅/弹窗内容块”，样式建议在主题 CSS 里写（更可控）
          html: "<div style=\"padding:24px; background:#fff\">赞助内容</div>"
